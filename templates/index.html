<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Air Quality - Pollution Explorer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body>
    <div class="overlay"></div>

    <main class="page-container">
      <section class="card">
        <h1>Air Quality – Pollution Explorer</h1>
        <p class="subtitle">
          Enter pollutant levels to calculate the Air Quality Index (AQI) and
          see the most polluted cities in India.
        </p>

        {% if not model_available %}
        <div class="global-error visible" role="alert">
          Prediction model could not be loaded on the server. Please ensure
          that <code>model.pkl</code> exists in the project root.
        </div>
        {% endif %}

        <form id="pollution-form" novalidate>
          <div class="form-grid">
            <!-- PM2.5 -->
            <div class="form-group">
              <label for="pm25">PM2.5 (µg/m³)</label>
              <input
                type="number"
                id="pm25"
                name="pm25"
                required
                step="0.1"
                min="{{ ranges['pm25']['min'] }}"
                max="{{ ranges['pm25']['max'] }}"
                placeholder="e.g. 35"
              />
              <small class="hint"
                >Permitted: {{ ranges['pm25']['min'] }}–{{
                ranges['pm25']['max'] }} µg/m³</small
              >
              <small class="error-message" data-error-for="pm25"></small>
            </div>

            <!-- PM10 -->
            <div class="form-group">
              <label for="pm10">PM10 (µg/m³)</label>
              <input
                type="number"
                id="pm10"
                name="pm10"
                required
                step="0.1"
                min="{{ ranges['pm10']['min'] }}"
                max="{{ ranges['pm10']['max'] }}"
                placeholder="e.g. 80"
              />
              <small class="hint"
                >Permitted: {{ ranges['pm10']['min'] }}–{{
                ranges['pm10']['max'] }} µg/m³</small
              >
              <small class="error-message" data-error-for="pm10"></small>
            </div>

            <!-- CO -->
            <div class="form-group">
              <label for="co">CO (mg/m³)</label>
              <input
                type="number"
                id="co"
                name="co"
                required
                step="0.01"
                min="{{ ranges['co']['min'] }}"
                max="{{ ranges['co']['max'] }}"
                placeholder="e.g. 0.8"
              />
              <small class="hint"
                >Permitted: {{ ranges['co']['min'] }}–{{
                ranges['co']['max'] }} mg/m³</small
              >
              <small class="error-message" data-error-for="co"></small>
            </div>

            <!-- NO2 -->
            <div class="form-group">
              <label for="no2">NO₂ (µg/m³)</label>
              <input
                type="number"
                id="no2"
                name="no2"
                required
                step="0.1"
                min="{{ ranges['no2']['min'] }}"
                max="{{ ranges['no2']['max'] }}"
                placeholder="e.g. 60"
              />
              <small class="hint"
                >Permitted: {{ ranges['no2']['min'] }}–{{
                ranges['no2']['max'] }} µg/m³</small
              >
              <small class="error-message" data-error-for="no2"></small>
            </div>

            <!-- SO2 -->
            <div class="form-group">
              <label for="so2">SO₂ (µg/m³)</label>
              <input
                type="number"
                id="so2"
                name="so2"
                required
                step="0.1"
                min="{{ ranges['so2']['min'] }}"
                max="{{ ranges['so2']['max'] }}"
                placeholder="e.g. 40"
              />
              <small class="hint"
                >Permitted: {{ ranges['so2']['min'] }}–{{
                ranges['so2']['max'] }} µg/m³</small
              >
              <small class="error-message" data-error-for="so2"></small>
            </div>

            <!-- O3 -->
            <div class="form-group">
              <label for="o3">O₃ (µg/m³)</label>
              <input
                type="number"
                id="o3"
                name="o3"
                required
                step="0.1"
                min="{{ ranges['o3']['min'] }}"
                max="{{ ranges['o3']['max'] }}"
                placeholder="e.g. 70"
              />
              <small class="hint"
                >Permitted: {{ ranges['o3']['min'] }}–{{
                ranges['o3']['max'] }} µg/m³</small
              >
              <small class="error-message" data-error-for="o3"></small>
            </div>
          </div>

          <div id="global-error" class="global-error" role="alert"></div>

          <button type="submit" class="btn-primary">
            Calculate Pollution Score
          </button>
        </form>
      </section>

      <section class="card results-card">
        <h2>Results</h2>
        <p class="subtitle" id="results-subtitle">
          Submit the form to see AQI and the most polluted cities.
        </p>

        <div class="results-summary" id="results-summary" hidden>
          <div class="summary-item">
            <span class="summary-label">Predicted AQI</span>
            <span class="summary-value" id="summary-aqi">—</span>
          </div>
          <div class="summary-item">
            <span class="summary-label">AQI Category</span>
            <span
              class="summary-value aqi-indicator"
              id="summary-category"
              >—</span
            >
          </div>
        </div>

        <div class="advice-card" id="advice-card" hidden>
          <div class="advice-header">
            <span class="advice-title">Health Advice &amp; Precautions</span>
          </div>
          <p class="advice-text" id="advice-text">
            <!-- Filled dynamically based on AQI category -->
          </p>
        </div>

        <div class="table-wrapper" id="results-container" hidden>
          <table>
            <thead>
              <tr>
                <th>City</th>
                <th>Average AQI</th>
              </tr>
            </thead>
            <tbody id="results-body">
              <!-- Filled by JS -->
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <script>
      // Pass permitted ranges into JS for client-side validation
      window.PERMITTED_RANGES = {{ ranges | tojson }};
    </script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
  </body>
</html>

